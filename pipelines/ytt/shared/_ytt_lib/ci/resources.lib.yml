#@ load("@ytt:data", "data")
#@ load("@ytt:template", "template")

#@ def slack():
name: slack
type: slack-notification
icon: slack
source:
  url: #@ data.values.slack.webhook
#@ end

#@ def image_source(repository, tag="latest"):
source:
  repository: #@ repository
  tag: #@ tag
  username: #@ data.values.dockerhub.username
  password: #@ data.values.dockerhub.password
#@ end

#@ def docker_image_type(name, repository, tag="latest"):
name: #@ name
type: docker-image
_: #@ template.replace(image_source(repository, tag))
#@ end

#@ def registry_image_type(name, repository, tag="latest"):
name: #@ name
type: registry-image
_: #@ template.replace(image_source(repository, tag))
#@ end

#@ def registry_image(name, repository, tag="latest"):
_: #@ template.replace(registry_image_type(name, repository, tag))
icon: docker
#@ end

#@ def docker_image(name, repository, tag="latest"):
_: #@ template.replace(docker_image_type(name, repository, tag))
icon: docker
#@ end

#@ def eirini_registry_image(component_name):
#@     return registry_image(component_name + "-image", "eirini/" + component_name)
#@ end

#@ def eirini_docker_image(component_name):
#@     return docker_image(component_name + "-image", "eirini/" + component_name)
#@ end

#@ def git(name, path, branch="master", private_key=None):
name: #@ name
type: git
icon: git
source:
  branch: #@ branch
  #@ if private_key:
  uri: #@ "git@github.com:" + path + ".git"
  private_key: #@ private_key
  #@ else:
  uri: #@ "https://github.com/" + path + ".git"
  #@ end
#@ end

#@ def cluster_event_created(cluster_name):
name: #@ "cluster-" + cluster_name + "-staging-event-created"
type: semver
icon: check-decagram
source:
  branch: events
  driver: git
  file: #@ cluster_name + "-event-created"
  initial_version: 0.1.0
  private_key: #@ data.values.private_keys.eirini_private_config
  uri: "git@github.com:cloudfoundry/eirini-private-config.git"
#@ end
